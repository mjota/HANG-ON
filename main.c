/*****************************************************

 HANG ON - A little Game for a 8051 & Nokia 3310 LCD
 Copyright (c) 2012 - Manuel Joaquin Díaz Pol

 This program is free software: you can redistribute it and/or modify it under
 the terms of the GNU General Public License as published by the Free Software
 Foundation, either version 3 of the License, or (at your option) any later
 version.

 This program is distributed in the hope that it will be useful, but WITHOUT
 ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 details.

 You should have received a copy of the GNU General Public License along with
 this program.  If not, see <http://www.gnu.org/licenses/>.

*****************************************************/

#include "main.h"
   
unsigned int poscar; 	//Posición horizontal del vehículo
int c,t,d,m=0; 		//Contadores
unsigned int posxobs,aposxobs,posyobs,easyobs; 		//Posiciones de los obstáculos
unsigned int nobs,nmov;		//Tiempo de movimiento de obstáculo y vehículo
unsigned int life; 		//Número de vidas
unsigned int flagobs, flagcar, flagtime, flagdie, flaglife = 0; //Controles para las interrupciones
unsigned int segs = 0;	//Tiempo
int sel = 0;			//Selección acelerómetros o botones
   
unsigned char code sega[504] = {	//Texto inicial SEGA
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x80,0xC0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0x00,0x00,0x00,0x00,0x80,
	0xC0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0x00,0x00,0x00,0x00,0x80,0xC0,
	0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x80,0xC0,0xE0,0xE0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x7C,0xE7,0x81,0x00,0x3C,0x6E,0x6E,0xEE,0xCE,0xCE,0x8E,0x0E,0x00,
	0x00,0x00,0xFF,0x03,0x01,0x78,0x7C,0x7E,0x7E,0x7E,0x7E,0x7E,0x0E,0x0E,0x00,0x00,
	0x00,0xFF,0x03,0x01,0xF8,0x0C,0x0E,0x7E,0x7E,0x7E,0x7E,0x7E,0x7E,0xFE,0x00,0x00,
	0x00,0x00,0x00,0x80,0xF0,0x1E,0x03,0xC0,0x78,0x70,0x81,0x07,0x38,0xE0,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0xF1,0xF3,0xF3,0xF7,0xF7,0xF6,0xBE,0x98,
	0xC0,0xE3,0x3E,0x00,0x00,0x00,0x7F,0xE0,0xC0,0x9F,0xB7,0xF7,0xF7,0xF7,0xF7,0xF7,
	0xF0,0xF0,0x00,0x00,0x00,0x7F,0xE0,0xC0,0x9F,0xB0,0xF0,0xF7,0xF7,0xF7,0xFF,0x80,
	0x80,0xFF,0x00,0x00,0x00,0xE0,0x3C,0x07,0xC0,0x70,0x7E,0x70,0x70,0x70,0x73,0x7C,
	0x60,0x01,0x0F,0x78,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x02,0x02,0x03,0x01,0x00,0x02,0x01,0x00,0x00,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

unsigned char code logo[504] = {	//Ventana inicial HANG-ON
	0xFF,0x03,0x03,0xFB,0xFB,0x03,0x03,0x03,0x03,0x03,0xFB,0xFB,0x03,0x03,0x03,0x03,
	0x03,0x03,0xC3,0x7B,0x7B,0xE3,0x03,0x03,0x03,0x03,0x03,0x03,0xFB,0xFB,0xF3,0xC3,
	0x03,0x03,0x03,0xFB,0xFB,0x03,0x03,0x03,0x03,0xE3,0xF3,0x33,0x1B,0x1B,0x1B,0x1B,
	0x73,0x23,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xE3,0xF3,0x13,0x1B,0x1B,
	0x1B,0x13,0xF3,0xE3,0x03,0x03,0x03,0x03,0xFB,0xFB,0xF3,0xC3,0x03,0x03,0x03,0xFB,
	0xFB,0x03,0x03,0xFF,0xFF,0x00,0x00,0x7F,0x7F,0x03,0x03,0x03,0x03,0x03,0x7F,0x7F,
	0x00,0x00,0x00,0x60,0x78,0x1F,0x1B,0x18,0x18,0x19,0x1F,0x7C,0x60,0x00,0x00,0x00,
	0x7F,0x7F,0x01,0x01,0x03,0x0E,0x3C,0x7F,0x7F,0x00,0x00,0x00,0x03,0x1F,0x3F,0x70,
	0x60,0x60,0x63,0x63,0x33,0x3F,0x00,0x00,0x00,0x0E,0x0E,0x0E,0x00,0x00,0x03,0x1F,
	0x3F,0x60,0x60,0x60,0x60,0x60,0x3F,0x1F,0x03,0x00,0x00,0x00,0x7F,0x7F,0x01,0x01,
	0x03,0x0E,0x3C,0x7F,0x7F,0x00,0x00,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xC3,
	0xC3,0xC3,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x80,0x82,0xC6,0xCF,0xDF,0xCF,0xC6,0x82,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0x00,
	0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0xFC,0xF8,
	0x70,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x02,0x07,0x0F,0x0F,0x1F,0x1F,0x1F,0x1F,0x1F,0x0F,0x0F,0x07,0x02,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,
	0x07,0x0F,0x1F,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,
	0x07,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

unsigned char code marizq[240] = {	//Selección botones
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xF3,0x13,0x13,0x13,0x13,0x13,0x13,0xD3,
	0xD3,0xD3,0x13,0x13,0x13,0x13,0x13,0x13,0xF3,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,
	0x80,0x82,0xC6,0xCF,0xDF,0xCF,0xC6,0x82,0x80,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0x00,
	0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0xFC,0xF8,
	0x70,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x7F,0x40,0x42,0x47,0x4F,0x4F,0x5F,0x5F,0x5F,0x5F,0x5F,0x4F,0x4F,0x47,0x42,0x40,
	0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,
	0x07,0x0F,0x1F,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,
	0x07,0x00,0x01,0x00,0x00,0x00,0x00,0x00
};

unsigned char code marder[240] = {	//Selección acelerómetros
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xC3,
	0xC3,0xC3,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x80,0x82,0xC6,0xCF,0xDF,0xCF,0xC6,0x82,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x01,0x01,0x01,0x81,0xC1,0x01,
	0x71,0x71,0x71,0x71,0x71,0x71,0x71,0x71,0x71,0x71,0x71,0x71,0x71,0x71,0xFD,0xF9,
	0x71,0x21,0x01,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x02,0x07,0x0F,0x0F,0x1F,0x1F,0x1F,0x1F,0x1F,0x0F,0x0F,0x07,0x02,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x40,0x42,
	0x47,0x4F,0x5F,0x47,0x47,0x47,0x47,0x47,0x47,0x47,0x47,0x47,0x47,0x47,0x47,0x47,
	0x47,0x40,0x41,0x40,0x40,0x40,0x40,0x7F
};

unsigned char code heart[8] = {		//Indicador de vida
	0x0C,0x1E,0x3E,0x7C,0x3E,0x1E,0x0C,0x00,
};

char nums[10] = {'0','1','2','3','4','5','6','7','8','9'};	//Conversor int-char para LCD

//Inicia los timers
void inittimer(){
	TMOD &= 0xF0;		//Timer 0 en modo 2: Contador autorecargable
	TMOD |= 0x0A;		
	
	TH0 = 0x00;	        //Valor inicial de autorecarga
	TL0 = 0x00;			//Valor inicial del contador
	ET0=1;				//Configura interrupción de timer 0
	EA=1;               //Habilita interrupciones
	TR0=1;	
}
 
//Rutina de servicio de interrupción
void it_timer0(void) interrupt 1{
	
	//Activa los flags si se presionan los botones/acelerómetros
	if (m<nmov){
		m++;
	}else{
		if (sel==0){
			if(BUT_ES==0){
				flagcar=1;
			}	
			if(BUT_DR==0){
				flagcar=2;
			}	
		}else{
			if(AC_ES==0){
				flagcar=1;
			}
			if(AC_DR==0){
				flagcar=2;
			}		
		}
	}
		
	//Activa el movimiento del obstáculo
	if(c<nobs){
		c++;
	}else{
		flagobs=1;
	}
	
	//Activa el cambio de segundos
	if(t<3921){
		t++;
	}else{
		flagtime=1;
	}
	
	//Comprueba si ha pasado entre los obstáculos
	if(posyobs==5){
		if((poscar>posxobs) && ((poscar+3) < (posxobs + easyobs))){
			LED=0;
		}else{
			flagdie=1;
		}
	}
	
	TF0 = 0;	//Pone a 0 el flag de interrupción
}

//Muestra las ventanas iniciales
void intro(){
	long int i;
	initlcd();

	//Muestra el logo de SEGA y aumenta la semilla
	pixelxy(0,0);
	for(i=0;i<504;i++)
		wrdata(sega[i]);
		
	while(1){
		if(BUT_AC==0){
			break;
		}
		i++;
	}
	
	srand(i);	//Semilla para que la partida sea distinta cada vez
	
	//Selección de botones o acelerómetros
	pixelxy(0,0);
	for(i=0;i<504;i++)
		wrdata(logo[i]);
		
	cursorxy(6,1);
	putstr("Buttons Accels");
		
	pixelxy(0,2);
	for(i=0;i<240;i++)
		wrdata(marizq[i]);
		
	while(1){
		if (sel==0){	//Marca acelerómetros
			if(BUT_DR==0){
				sel=1;
				nmov = 60;
				nobs = 3500;	//Más lento con acelerómetros
				pixelxy(0,2);
				for(i=0;i<240;i++)
					wrdata(marder[i]);
			}
		}else{			//Marca botones
			if(BUT_ES==0){
				sel=0;
				nmov = 20;
				nobs = 1500;	//Más rápido con botones
				pixelxy(0,2);
				for(i=0;i<240;i++)
					wrdata(marizq[i]);
			}
		}		
		if(BUT_AC==0){
			break;
		}
	}
}

//Muestra la ventana de juego inicial
void initgame(){
	int i;
	
	//Limpia la pantalla
	pixelxy(0,0);
	for(i=0;i<504;i++)
		wrdata(0x00);
	
	//Pinta el vehículo
	pixelxy(40,5);
	for(i=0;i<4;i++)
		wrdata(0x0F);
	
	//Pinta los marcadores superiores iniciales
	cursorxy(1,1);
	putstr("000");	
	cursorxy(1,12);
	putchar('0');
	pixelxy(75,0);
	for (i=0;i<8;i++){
		wrdata(heart[i]);
	}
	pixelxy(0,1);
	for (i=0;i<84;i++)
		wrdata(0x01);	
	
	//Inicializa las variables del juego
	poscar = 40;
	posxobs = numrandom(42);
	life=0;
	posyobs = 1;
	easyobs = 42;

}

//Calcula un número aleatorio
unsigned int numrandom(unsigned int max){
	unsigned int num;
	num = rand() % max;
	return num;
}	

//Mueve los obstáculos
void movobs(){
	int rightobs;	//Obstáculo de la derecha
	
	if (posyobs==1){		//Si es el primero borra antes línea 5
		pixelxy(aposxobs,5);
		wrdata(0x00);
		
		rightobs = aposxobs + easyobs;
		pixelxy(rightobs,5);
		wrdata(0x00);	
		easyobs = 42 - numrandom(35);	//Cambia la amplitud del obstáculo
	}
	
	if (posyobs<6){	//Si es cualquier otro borra el anterior		
		pixelxy(posxobs,posyobs);
		wrdata(0xFF);
		
		rightobs = posxobs + easyobs;
		pixelxy(rightobs,posyobs);
		wrdata(0xFF);
		
		//Limpieza anterior
		if (posyobs==2){	//Si era el 1, debe pintar línea horizontal
			pixelxy(posxobs,1);
			wrdata(0x01);
			pixelxy(rightobs,1);
			wrdata(0x01);
			flaglife=0;	//Pone a 0 el flag si antes perdió una vida
		}
		if (posyobs>2){
			pixelxy(posxobs,posyobs-1);
			wrdata(0x00);
			pixelxy(rightobs,posyobs-1);
			wrdata(0x00);
		}	
		posyobs++;		
	}else{	//Final de obstáculo, vuelve a empezar
		posyobs = 1;
		aposxobs = posxobs;
		posxobs = numrandom(42);
	}
}

//Movimiento del coche, pinta la nueva posición y borra anterior
void changecar(){
	int i;
	
	if ((poscar<81) && (poscar>=0)){ 
		pixelxy(poscar-1,5);
		wrdata(0x00);
	
		pixelxy(poscar+5,5);
		wrdata(0x00);
			
		pixelxy(poscar,5);
		for(i=0;i<4;i++)
			wrdata(0x0F);
	}
}

//Pinta el tiempo en el LCD
void changetime(){
	int num;
	char tex[3];
	
	if (segs>999)	//Resetea a 1
		segs=1;
	
	if ((segs % TIMELIFE) == 0){	//Vida extra a los X segs
		if (life<6){
			life++;
			cursorxy(1,12);
			putchar(nums[life]);
			LED=0;
			BUZ=0;
		}
	}
	
	//Pinta las centenas si cambian	
	num = segs / 100;
	if (tex[0] != nums[num]){
		tex[0] = nums[num];
		cursorxy(1,1);
		putchar(tex[0]);
	}
	
	//Pinta las decenas si cambian
	num = (segs % 100) / 10;
	if (tex[1] != nums[num]){
		tex[1] = nums[num];
		cursorxy(1,2);
		putchar(tex[1]);
	}

	//Pinta las unidades
	num = segs % 10;
	tex[2] = nums[num];	
	cursorxy(1,3);
	putchar(tex[2]);
}

//Ventana de fin del juego
void gameover(){
	int i;
	pixelxy(0,1);
	for(i=0;i<420;i++)	//Borra bajo la línea, tiempo visible
		wrdata(0x00);
		
	cursorxy(3,3);
	putstr("GAME OVER");
	
	cursorxy(6,2);
	putstr("Press Reset");
	
	BUZ = 1;
	while(1){
	}
}

void main(){
	LED=0;	//Test 
	
	intro();	//Muestra pantallas iniciales	
	initgame();	//Configura juego	
	
	inittimer();	//Inicia timer
	
	LED=1;

	while(1){
		if(flagcar==1){	//Mueve el coche a la izquierda
			poscar--;
			changecar();
			flagcar=0;
			m=0;	//Reset contador
		}
		if(flagcar==2){	//Mueve el coche a la derecha
			poscar++;
			changecar();
			flagcar=0;
			m=0;	//Reset contador
		}
		
		if(flagobs==1){	//Mueve el obstáculo
			movobs();
			d++;
			c= 0 + (d * 2);	//Aumenta la velocidad del obstáculo
			flagobs=0;
		}
		
		if(flagtime==1){	//Aumenta los segundos
			t=0;	//Reset contador
			segs++;
			changetime();
			flagtime=0;
		}
		
		if(flagdie==1){	//Si falla muestra fin del juego
			flagdie=0;
			if(flaglife==0){
				if(life>0){	//Resta una vida
					BUZ = 0;
					flaglife=1;
					life--;
					cursorxy(1,12);
					putchar(nums[life]);
				}else{	//Fin del juego
					BUZ = 0;
					gameover();
				}
			}
		}
		
		if (LED==0)	//Parpadeo al superar obstáculo
			LED = 1;
		if (BUZ==0)
			BUZ=1;
	}
}
