/*****************************************************

        Plug n Play Library for Nokia 3310 LCD

        Author:  Ajay Bhargav
		Email :  contact@rickeyworld.info
		WWW   :  www.8051projects.net

		File  :  Nokia3310.C
		Info  :  Test Program to check working of
		         Library

*****************************************************/

#include "main.h"


/* Some Custom Graphics data
   Run it and see it :)      */
   
unsigned int poscar;
int c=0; 
   
unsigned char code sega[504] = {
	0xFF,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x80,
	0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x1E,0x31,0x20,0x40,0x40,0x40,0x40,0x81,0x83,0x0F,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFF,0x40,0x40,0x40,0x40,0xF0,0x00,0x00,0x00,0x07,0x00,0x00,
	0x00,0x00,0xF8,0x06,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x07,0x00,0x00,
	0x00,0x00,0x00,0x00,0x80,0x70,0x0E,0x01,0x01,0x0E,0x70,0x80,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x30,0x20,0x40,0x40,0x40,0x40,0x40,0x20,0x30,
	0x0F,0x00,0x00,0x00,0x00,0x00,0x40,0x40,0x7F,0x40,0x40,0x40,0x40,0x41,0x40,0x40,
	0x40,0x40,0x7C,0x00,0x00,0x00,0x07,0x18,0x20,0x20,0x40,0x40,0x41,0x41,0x41,0x41,
	0x21,0x3F,0x01,0x01,0x40,0x40,0x70,0x4C,0x43,0x01,0x01,0x01,0x01,0x01,0x01,0x43,
	0x4C,0x70,0x40,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
	0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xFF
};

unsigned char code presents[54] = {
	0x82,0xFE,
	0xA2,0x22,0x1C,0x00,0x00,0x88,0xF8,0x90,0x88,0x08,0x00,0x00,0x70,0xA8,0xA8,0xA8,
	0xB0,0x00,0x00,0x90,0xA8,0xA8,0xA8,0x48,0x00,0x00,0x70,0xA8,0xA8,0xA8,0xB0,0x00,
	0x88,0xF8,0x90,0x08,0x88,0xF0,0x80,0x08,0x7C,0x88,0x88,0x88,0x40,0x00,0x00,0x90,
	0xA8,0xA8,0xA8,0x48
};

void inittimer(){
	P2=0x00;                   // clear op
	TMOD=0x90;               // set timer 1
	TH1=0x3C;                 // load count 15535
    TL1=0xAF;

    IE=0x88;                    // enable timer 1 interrupt
    LED=0;                      // LED on
    TR1=1;                     // timer 1 start
   }

void timer1(void) interrupt 3{    // timer 1 overflow vactor
	TF1=0;                             // clear overflow flag  
	c++;                                 // increment counter
	if(c==200){                        // if 100 counts of 50 ms(= 5 sec) are over
		TR1=0;                      // stop timer 
		LED=1;
	} 
	TH1=0x3C;                      // other reaload timer 1 with
	TL1=0xAF;                      // 15535 to count 50 ms  
}

void intro(){
	int i;
	initlcd();
	//Print string to LCD
	//putstr("Welcome to Rickey");

	pixelxy(0,0);
	for(i=0;i<504;i++)
		wrdata(sega[i]);
		
	pixelxy(14,4);
	for(i=0;i<54;i++)
		wrdata(presents[i]);
}

void initgame(){
	int i;
	pixelxy(0,0);
	for(i=0;i<504;i++)
		wrdata(0x00);
	
	pixelxy(40,5);
	for(i=0;i<4;i++)
		wrdata(0x0F);
	
	poscar = 40;
}

void changecar(){
	int i;
	//unsigned int posexa,posexp;
	
	if ((poscar<81) && (poscar>=0)){ 
		/*posexa = poscar - 1;
		pixelxy(posexa,5);
		wrdata(0x00);
	
		posexp = poscar + 5;
		pixelxy(posexp,5);
		wrdata(0x00);*/
	
		pixelxy(0,5);
		for(i=0;i<84;i++)
			wrdata(0x00);
			
		pixelxy(poscar,5);
		for(i=0;i<4;i++)
			wrdata(0x0F);
	}
}

void main(){
	inittimer();
	
	intro();	
	initgame();
	
	
	while(1){
		if(AC_DR==0)
			LED = 0;
		else
			LED = 1;

		if(AC_ES==0)
			BUZ = 0;
		else
			BUZ = 1;

		if(BUT_ES==0){
			poscar--;
			changecar();
		}
		
		if(BUT_DR==0){
			poscar++;
			changecar();
		}
		
		if(BUT_AC==0){
			poscar++;
			changecar();
		}


	}
}
